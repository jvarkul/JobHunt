<div class="jobs-container">
  <div class="header">
    <h1 class="page-title">Job Applications</h1>
    <p class="page-subtitle">Track and manage your job applications</p>
  </div>

  <!-- Add New Job Form -->
  <div class="form-section">
    <form [formGroup]="jobForm" (ngSubmit)="onSubmit()" class="job-form">
      <div class="form-group">
        <label for="new-job-company" class="form-label">Company Name *</label>
        <input
          id="new-job-company"
          type="text"
          formControlName="company_name"
          placeholder="Enter company name..."
          class="form-input"
          [class.error]="isFieldInvalid(jobForm, 'company_name')"
        />
        <div class="error-message" *ngIf="isFieldInvalid(jobForm, 'company_name')">
          {{ getFieldError(jobForm, 'company_name') }}
        </div>
      </div>

      <div class="form-group">
        <label for="new-job-description" class="form-label">Job Description *</label>
        <textarea
          id="new-job-description"
          formControlName="description"
          placeholder="Enter job description, requirements, responsibilities..."
          class="form-textarea"
          [class.error]="isFieldInvalid(jobForm, 'description')"
          rows="4"
        ></textarea>
        <div class="error-message" *ngIf="isFieldInvalid(jobForm, 'description')">
          {{ getFieldError(jobForm, 'description') }}
        </div>
      </div>

      <div class="form-group">
        <label for="new-job-link" class="form-label">Application Link (Optional)</label>
        <input
          id="new-job-link"
          type="url"
          formControlName="application_link"
          placeholder="https://example.com/careers/job-posting"
          class="form-input"
          [class.error]="isFieldInvalid(jobForm, 'application_link')"
        />
        <div class="error-message" *ngIf="isFieldInvalid(jobForm, 'application_link')">
          {{ getFieldError(jobForm, 'application_link') }}
        </div>
      </div>

      <button
        type="submit"
        class="submit-button"
        [disabled]="isSubmitting || jobForm.invalid"
        [class.loading]="isSubmitting"
      >
        <span *ngIf="!isSubmitting">Add Job Application</span>
        <span *ngIf="isSubmitting" class="loading-content">
          <span class="spinner"></span>
          Adding...
        </span>
      </button>
    </form>
  </div>

  <!-- Error Message -->
  <div class="error-message global-error" *ngIf="errorMessage">
    {{ errorMessage }}
  </div>

  <!-- Jobs List -->
  <div class="jobs-section">
    <div class="section-header">
      <h2 class="section-title">Your Job Applications</h2>
      <span class="job-count" *ngIf="jobs.length > 0">{{ jobs.length }} application{{ jobs.length !== 1 ? 's' : '' }}</span>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <div class="spinner large"></div>
      <p>Loading your job applications...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && jobs.length === 0" class="empty-state">
      <div class="empty-icon">üíº</div>
      <h3>No job applications yet</h3>
      <p>Start tracking your job applications by adding your first one above.</p>
    </div>

    <!-- Jobs List -->
    <div *ngIf="!isLoading && jobs.length > 0" class="jobs-list">
      <div
        *ngFor="let job of jobs; trackBy: trackByJobId"
        class="job-item"
        [class.editing]="editingJob?.id === job.id"
      >
        <!-- View Mode -->
        <div *ngIf="editingJob?.id !== job.id" class="job-content">
          <div class="job-header">
            <h3 class="company-name">{{ job.company_name }}</h3>
          </div>

          <div class="job-description">
            <div *ngIf="!isDescriptionExpanded(job.id)" class="description-preview">
              {{ getPreviewText(job.description) }}
            </div>
            <div *ngIf="isDescriptionExpanded(job.id)" class="description-full">
              {{ job.description }}
            </div>
            <button
              *ngIf="shouldShowReadMore(job.description)"
              (click)="toggleDescription(job.id)"
              class="read-more-button"
            >
              {{ isDescriptionExpanded(job.id) ? 'Read Less' : 'Read More' }}
            </button>
          </div>

          <div class="job-link" *ngIf="job.application_link">
            <a [href]="job.application_link" target="_blank" rel="noopener noreferrer" class="application-link">
              <span class="link-icon">üîó</span>
              View Application
              <span class="external-icon">‚Üó</span>
            </a>
          </div>

          <div class="job-meta">
            <span class="job-date">Updated {{ formatDate(job.updated_at) }}</span>
          </div>

          <div class="job-actions">
            <button (click)="startEdit(job)" class="action-button edit">
              <span class="icon">‚úèÔ∏è</span>
              Edit
            </button>
            <button (click)="deleteJob(job)" class="action-button delete">
              <span class="icon">üóëÔ∏è</span>
              Delete
            </button>
          </div>
        </div>

        <!-- Edit Mode -->
        <div *ngIf="editingJob?.id === job.id" class="job-edit">
          <form [formGroup]="editForm" (ngSubmit)="saveEdit()" class="edit-form">
            <div class="form-group">
              <label class="form-label">Company Name *</label>
              <input
                type="text"
                formControlName="company_name"
                class="form-input"
                [class.error]="isFieldInvalid(editForm, 'company_name')"
                placeholder="Enter company name..."
              />
              <div class="error-message" *ngIf="isFieldInvalid(editForm, 'company_name')">
                {{ getFieldError(editForm, 'company_name') }}
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Job Description *</label>
              <textarea
                formControlName="description"
                class="form-textarea"
                [class.error]="isFieldInvalid(editForm, 'description')"
                rows="4"
              ></textarea>
              <div class="error-message" *ngIf="isFieldInvalid(editForm, 'description')">
                {{ getFieldError(editForm, 'description') }}
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Application Link (Optional)</label>
              <input
                type="url"
                formControlName="application_link"
                class="form-input"
                [class.error]="isFieldInvalid(editForm, 'application_link')"
                placeholder="https://example.com/careers/job-posting"
              />
              <div class="error-message" *ngIf="isFieldInvalid(editForm, 'application_link')">
                {{ getFieldError(editForm, 'application_link') }}
              </div>
            </div>

            <div class="edit-actions">
              <button type="submit" class="action-button save" [disabled]="editForm.invalid">
                Save
              </button>
              <button type="button" (click)="cancelEdit()" class="action-button cancel">
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>